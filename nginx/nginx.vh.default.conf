upstream php {
  server unix:/tmp/php-cgi.socket;
  server wordpress:9000;
}

server {
  listen       80;
  server_name  stachl.me;
  

  #charset utf8;
  #access_log  /var/log/nginx/host.access.log  main;

  add_header X-Frame-Options DENY;

  root   /var/www/html;
  index  index.php index.html;

  rewrite ^/sitemap_index\.xml$ /index.php?sitemap=1 last;
  rewrite ^/([^/]+?)-sitemap([0-9]+)?\.xml$ /index.php?sitemap=$1&sitemap_n=$2 last; 
  
  location = /favicon.ico {
    log_not_found off;
    access_log off;
  }
 
  location = /robots.txt {
    allow all;
    log_not_found off;
    access_log off;
  }
 
  location ~ /\.svn|/\.ht|/\.git {
    deny all;
  }
  
  location / {
    # This is cool because no php is touched for static content.
    # include the "?$args" part so non-default permalinks doesn't break when using query string
    try_files $uri
              $uri/
              /index.php?$args;

    gzip on;
    gzip_static on;
    gzip_disable "MSIE [1-6]\.";
    default_type text/html;
    gzip_types text/plain text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript;
  }
  
  location ~ \.php$ {
    #NOTE: You should have "cgi.fix_pathinfo = 0;" in php.ini
    include fastcgi_params;
    fastcgi_index index.php;
    fastcgi_intercept_errors on;
    fastcgi_pass php;
  }

  location ~* \.(?:js|css|png|jpe?g|gif|ico|html|txt)$ {
    expires 7d;
    log_not_found off;
  }
}
